# File structures

## Storage Hierachy

컴퓨터의 저장 장치는 크게 세가지로 분류된다.

1. Primary storage (주 기억장치)
   - CPU가 직접 접근하는 장치로 **RAM**, **캐시** 등이 있다.
   - CPU가 직접 접근하는 만큼, 속도가 매우 빠르지만 비용이 비싸다는 단점이 있다.
2. Secondary storage (보조 기억장치)
   - HDD, Flask 메모리 등
   - 속도는 느리지만 대용량이다.
   - **DB의 레코드는 보조 기억장치에 저장된다.**
3. Tetiary storage (3차 저장장치)
   - CD-ROM, DVD 등 Offline 상태를 가질 수 있는 저장장치를 의미한다.

DB의 레코드는 보조 기억장치에 저장되고, 이것을 어떻게 저장하느냐에 따라 접근에 걸리는 시간이 결정된다. 도서관에 갔을 때 내가 읽을 책의 종류와 장르에 따라 구분된 것처럼 레코드 또한 물리적으로 잘 정돈해놓아야 추후 꺼내 쓸 때 빠르게 꺼내 쓸 수 있는 것이다.

## Primary File Organizations (주 파일 기법)

주 파일 기법이란, 레코드의 물리적 저장 방식 기법을 의미한다. 주 파일 기법에는 다음과 같은 방법이 존재한다.

1. Heap file (Unordered file) 기법
   - 데이터가 추가되는 순서대로 저장하는 방식
2. Sorted file (Sequential file) 기법
   - 데이터를 정렬하여 저장하는 방식
   - 데이터를 정렬할 땐 정렬 기준이 필요한데 이를 `sort key`라고 칭함.
3. Hashed file 기법
   - Hash를 이용하여 저장 위치를 정하는 기법

이 외에도, 주 파일 기법에는 트리 구조를 사용한 기법 등이 존재한다.

### Heap Files

주 파일 기법 중 `Heap file`은 삽입된 순서대로 레코드를 저장하는 방식이다. 레코드 수집을 위한 목적으로 사용된다.

`Heap File`에서의 탐색

- 만약 레코드가 유일하다면? 탐색하는데 걸리는 시간 평균 _record / 2_ 만큼
- 만약 레코드가 유일하지 않다면? 탐색하는 걸리는 시간 _record_ 만큼

`Heap File`에서의 삽입

- 파일의 마지막 디스크 블록을 버퍼로 `load`한다.
- 새로운 레코드를 작성한다.
- 버퍼의 내용을 다시 디스크로 작성하여 갱신한다.

`Heap File`에서의 삭제

- 레코드가 담긴 블록을 찾는다.
- 찾은 디스크 블록을 버퍼로 `load`한다.
- 지우려는 레코드를 버퍼에서 지운다.
- 버퍼의 내용을 다시 디스크로 작성하여 갱신한다.

`Heap File`의 특징

- 삭제 시 해당 레코드 부분이 비어있어 공간의 효율성이 줄어든다.
- 삭제되었음을 표시하기 위해 `deletion marker`를 레코드에 표시한다.

`External sorting` 기법

- 파일의 크기가 메모리에 비해 클 때 정렬하기 위한 기법
  - 전체 파일을 메모리의 크기만큼 잘라 메모리에 적재될 수 있도록 한다.
  - 메모리에 적재된 `subfile`을 정렬시켜 `sorted subfile`을 얻는다. `sorted subfile`은 별도의 `temporary file`에 작성한다.
  - `temporary file`이 전부 차면 새로운 `temporary merge file`에 병합하여 작성한다.
  - 위 과정을 거쳐 최종적인 `final result file`을 얻는다.
  - **파일의 크기에 3배 만큼 공간이 필요하다**

### Sorted Files

대부분의 파일 구조가 이 파일 구조를 택하고 있다.
`Ordering key`를 정해 해당 키를 기준으로 레코드를 정렬해 저장한다.

`Sorted Files`의 이점

- 레코드를 순서대로 읽는 것이 매우 쉽다. (정렬이 필요 없음)
- 정렬된 레코드이기 때문에 이분 탐색을 사용한 접근이 가능하다.

`Sorted Files`의 삽입과 삭제

- `Sorted Files`는 반드시 정렬된 상태를 유지해야하기 때문에 삽입과 삭제의 비용이 크다.
- 삽입의 경우 삽입될 위치의 레코드를 한칸씩 뒤로 밀어야 된다는 점.
  - 이것을 방지하고자, **블럭의 공간을 임의로 비워두는 전략**을 사용한다.
- 삭제의 경우엔 `deletion marker`를 사용해 비용을 절감할 수 있다.

`Transaction File` 도입 및 사용
